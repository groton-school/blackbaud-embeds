<!-- for more information about this snippet, visit https://github.com/groton-school/blackbaud-embeds/tree/main/embeds/_shared#install-phone-app -->
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"
  integrity="sha512-PEhlWBZBrQL7flpJPY8lXx8tIN7HWX912GzGhFTDqA3iWFrakVH3lVHomCoU9BhfKzgxfEk6EG2C3xej+9srOQ=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/Detect.js/2.2.2/detect.min.js"
  integrity="sha512-iNuMM5cmiXDvk4VCTp6UEbDwYy/dA3CFTTYKB6/V+LD62S58TQZ+sykXzhmVT1QvqHD39ZhecsPGXjZUaIuSWQ=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>
<style>
  #app-store-links {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-around;
    width: 100%;
  }

  .app-store {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .app-store canvas {
    min-width: 200px;
    min-height: 200px;
  }

  #apple-app-store a {
    display: inline-block;
    overflow: hidden;
    border-radius: 13px;
    width: 250px;
    height: 83px;
  }

  #apple-app-store a img {
    border-radius: 13px;
    width: 250px;
    height: 83px;
  }

  #google-play-store a {
    width: 279px;
    height: 83px;
    overflow: hidden;
  }

  #google-play-store a img {
    width: 319px;
    margin: -20px 0 0 -20px;
  }

  .qrcode.instructions {
    text-align: center;
    color: darkgray;
  }

  .hide-embed {
    display: none;
    visibility: none;
    height: 0;
    width: 0;
  }
</style>
<div id="app-store-links">
  <div id="apple-app-store" class="app-store">
    <a
      ><img
        src="https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/en-us?size=250x83&amp;releaseDate=1320192000"
        alt="Download on the App Store"
    /></a>
    <canvas class="qrcode"></canvas>
  </div>
  <div id="google-play-store" class="app-store">
    <a
      ><img
        alt="Get it on Google Play"
        src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png"
    /></a>
    <canvas class="qrcode"></canvas>
  </div>
</div>
<div class="qrcode instructions">
  Scan the QR Code above for your app store with your phone camera
</div>
<script>
  /* global QRCode detect */
  // copy URL generated by https://tools.applemediaservices.com/app-store/?utm_source=pocket_mylist
  // set to null to not show Apple button/QR code
  const appleUrl = 'TODO replace with URL or null';

  // copy URL from https://play.google.com/
  // set to null to not show Android button/QR code
  const androidUrl = 'TODO replace with URL or null';

  function makeLink(url, selector) {
    const elt = document.querySelector(`${selector} a`);
    if (elt) {
      elt.href = url;
    } else {
      setTimeout(makeLink.bind(null, url, selector), 5);
    }
  }

  function showQRCode(url, selector) {
    if (window.QRCode) {
      const elt = document.querySelector(`${selector} canvas.qrcode`);
      if (elt) {
        QRCode.toCanvas(elt, url, (error) => {
          if (error) console.error(error);
        });
        return;
      }
    }
    setTimeout(showQRCode.bind(null, url, selector), 5);
  }

  function hide(selector) {
    document.querySelector(selector).classList.add('hide');
  }

  function detectBrowser() {
    if (window.detect) {
      const ua = detect.parse(navigator.userAgent);
      if (ua.device.type == 'Mobile') {
        if (ua.os.family == 'iOS') {
          hide('#google-play-store');
          hide('#apple-app-store canvas.qrcode');
        } else if (ua.os.family == 'Android') {
          hide('#apple-app-store');
          hide('#google-play-store canvas.qrcode');
        }
        hide('.qrcode.instructions');
      }
    } else {
      setTimeout(detectBrowser, 5);
    }
  }

  detectBrowser();

  if (appleUrl && appleUrl.length) {
    makeLink(appleUrl, '#apple-app-store');
    showQRCode(appleUrl, '#apple-app-store');
  } else {
    hide('#apple-app-store');
  }

  if (androidUrl && androidUrl.length) {
    makeLink(androidUrl, '#google-play-store');
    showQRCode(androidUrl, '#google-play-store');
  } else {
    hide('#google-play-store');
  }
</script>
